{% extends "base.html" %}

{% block title %}Configure Device - Load Balancing Methods{% endblock %}

{% block content %}
<link href="{{ url_for('static', filename='CSS/serverOverview.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='CSS/rule.css') }}" rel="stylesheet">

<style>

  .labelcst{
    width: 67px;
  }
  .labelweight {
  text-align: start;
  max-width: 72px;
}
.labelcustom{
  width: 200px;
}
  .red-text {
    color: #ff6b6b;
  }
  .indent {
    margin-left: 20px;
  }

  
  label {
    color: #c7c7c7;
    width: 707px;
  }

  .customselect {
    margin-left: 2px;
    border: none;
    border-bottom: 2px solid #fff; 
    outline: none;
    padding: 5px 0;
    background-color: transparent;
    box-shadow: none;
    font-size: 16px;
    color: #fff;
    width: 100%;
    max-width: 250px;
    height: 36px;
  }

  .dropdown-group {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }
 

  .customsearch{
    border: none;
    border-bottom: 2px solid #fff; 
    outline: none;
    padding: 5px 0;
    background-color: transparent;
    box-shadow: none;
    font-size: 16px;
    color: #ffffff;
    width: 100%;
  }

  
  select {
    background-color: #333;
    color: #ffffff;
    border: 1px solid #555;
    padding: 5px;
  }

 
  .customselect option {
    background-color: #ffffff;
    color: black;
  }

  .customselect:focus {
    border-bottom: 2px solid #fff; 
    box-shadow: none;
  }

  
  /* Flex container to align labels and selects consistently */
  .dropdown-group {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }
 
  .customsearch{
    border: none;
    border-bottom: 2px solid #fff; 
    outline: none;
    padding: 5px 0;
    background-color: transparent;
    box-shadow: none;
    font-size: 16px;
    color: #ffffff;
    width: 100%;
  }

  .custombtn {
background: none;
border: none;
color: #ffffff;
padding: 0;
font-size: 16px;
cursor: pointer;
display: inline-flex;
align-items: center;
margin-left: 15px;
}
.buttonstyle{
color:white;
width: 160px;
height: 30px;
border-radius: 5px !important;
text-align: left;
padding-left:5px;
padding-top: 1px;
font-weight: 700;
margin: 2px;
}
.customRemove {
background-color: #681313;
border:solid 1px #FF7676;
}
.customView{
background-color: #055858;
border:solid 1px #2BB7DC;
width: 170px;
}
.customView:hover{
border:solid 1px #2BB7DC;
width: 170px;
}
.customConfig{
background-color: #652C0D;
border:solid 1px #FFAA7B;
}
.customConfig:hover{
border:solid 1px #FFAA7B;
}
</style>
<div class="container customContainer mt-2">
    <div class="d-flex  mb-3">
      <input type="text" class="search-bar" placeholder="Search...">
  </div>
<div class="container customContainer mt-2">
  <div class="card-content" id="methods">
    <div class="row">
      <div class="col-md-4">
        <h4>Load Balancing Method</h4>
        <div class="dropdown-group">
          <input type="checkbox" id="staticMethod">
          <label for="staticMethod">Static Method</label>
        </div>
        <div class="indent">
          
            <div class="indent">
                <div id="serverWeights">
                    <!-- populate this section dynamically -->
                </div>
            </div>
        </div>



        <div class="dropdown-group">
          <input type="checkbox" id="dynamicMethod">
          <label for="dynamicMethod">Dynamic Method</label>
        </div>

        <div class="indent">
          <div class="dropdown-group">
            <input type="checkbox" id="cpuUsage">
            <label for="cpuUsage">CPU Usage</label>
            <label for="cpuUsageWeight" class="labelweight">Weight:</label>
            <select id="cpuUsageWeight" class="customselect">
              <option value="0">0</option>
              <option value="10">10</option>
              <option value="20">20</option>
              <option value="30">30</option>
              <option value="40">40</option>
              <option value="50">50</option>
              <option value="60">60</option>
              <option value="70">70</option>
              <option value="80">80</option>
              <option value="90">90</option>
              <option value="100">100</option>
            </select>
          </div>
  
          <div class="dropdown-group">
            <input type="checkbox" id="memoryUsage">
            <label for="memoryUsage">Memory Usage</label>
            <label for="memoryUsageWeight" class="labelweight">Weight:</label>
            <select id="memoryUsageWeight" class="customselect">
              <option value="0">0</option>
              <option value="10">10</option>
              <option value="20">20</option>
              <option value="30">30</option>
              <option value="40">40</option>
              <option value="50">50</option>
              <option value="60">60</option>
              <option value="70">70</option>
              <option value="80">80</option>
              <option value="90">90</option>
              <option value="100">100</option>
            </select>
          </div>
  
          <div class="dropdown-group">
            <input type="checkbox" id="diskUsage">
            <label for="diskUsage">Disk Usage</label>
            <label for="diskUsageWeight" class="labelweight">Weight:</label>
            <select id="diskUsageWeight" class="customselect">
              <option value="0">0</option>
              <option value="10">10</option>
              <option value="20">20</option>
              <option value="30">30</option>
              <option value="40">40</option>
              <option value="50">50</option>
              <option value="60">60</option>
              <option value="70">70</option>
              <option value="80">80</option>
              <option value="90">90</option>
              <option value="100">100</option>
            </select>
          </div>
  
          <div class="dropdown-group">
            <input type="checkbox" id="leastConnectionsResource">
            <label for="leastConnectionsResource">Least Connections</label>
            <label for="leastConnectionsWeight" class="labelweight">Weight:</label>
            <select id="leastConnectionsWeight" class="customselect">
              <option value="0">0</option>
              <option value="10">10</option>
              <option value="20">20</option>
              <option value="30">30</option>
              <option value="40">40</option>
              <option value="50">50</option>
              <option value="60">60</option>
              <option value="70">70</option>
              <option value="80">80</option>
              <option value="90">90</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
        <div class="dropdown-group">
          <input type="checkbox" id="predictiveAI">
          <label for="predictiveAI">Predictive AI Driven Enhancement</label>
        </div>
        <p class="red-text">Predictive enhances static and dynamic methods to make smarter decisions based on future traffic patterns.</p>
      </div>
  
      <!-- Column 2: Load Balancing Strategies -->
      <div class="col-md-4">
        <h4>Load Balancing Strategies</h4>
        <div class="checkbox-group">
          <div>
            <input type="checkbox" id="RoundRobin">
            <label for="RoundRobin" class="labelcustom">Round Robin</label>
          </div>
          <div>
            <input type="checkbox" id="WeightedRoundRobin">
            <label for="WeightedRoundRobin" class="labelcustom">Weighted Round Robin</label>
          </div>
          <div>
            <input type="checkbox" id="LeastConnections">
            <label for="LeastConnections" class="labelcustom">Least Connections</label>
          </div>
          <div>
            <input type="checkbox" id="LeastResponseTime">
            <label for="LeastResponseTime" class="labelcustom">Least Response Time</label>
          </div>
          <div>
            <input type="checkbox" id="Resource-Based">
            <label for="Resource-Based" class="labelcustom">Resource-Based</label>
          </div>
          <div>
            <input type="checkbox" id="Custom">
            <label for="Custom" class="labelcst">Custom</label>
          </div>
        </div>
      </div>
  
      <!-- Column 3: Load Balancing Failover Priority -->
      <div class="col-md-4">
        <h4>Load Balancing Active Strategies</h4>
        <div class="mb-3">
          <div class="dropdown-group">
            <label for="failoverPriority1" class="labelcst">Active:</label>
            <select id="failoverPriority1" class="customselect">
              <option>Round Robin</option>
              <option>Least Connections</option>
              <option>Weighted Round Robin</option>
              <option>Least Response Time</option>
              <option>Resource-Based</option>  
            </select>
          </div>
        </div>
        <div class="mb-3">
          <div class="dropdown-group">
            <label for="failoverPriority2" class="labelcst">Failover:</label>
            <select id="failoverPriority2" class="customselect">
              <option>Round Robin</option>
              <option>Least Connections</option>
              <option>Weighted Round Robin</option>
              <option>Least Response Time</option>
              <option>Resource-Based</option> 
            </select>
          </div>
        </div>
      </div>
    </div>
    <button type="button" class="btn btn-sm customView buttonstyle me-5" id="tab2button">Apply Changes</button>
    <button type="button" class="btn btn-sm customConfig buttonstyle">Reset to Default</button>
  </div>
</div>
<script src="{{ url_for('static', filename='JS/load_balancer.js') }}"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    console.log("Current URL:", window.location.href); // Debugging

    // Extract group_id from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    let groupId = urlParams.get("group_id");

    console.log("Raw extracted group_id:", groupId); // Debugging

    // any formatting issues (removing curly brackets)
    if (groupId) {
        groupId = groupId.replace(/[{}]/g, ""); // Remove { and }
    }

    console.log("Sanitized group_id:", groupId); // Debugging

    // Validate groupId
    if (!groupId || isNaN(groupId)) {
        console.error("âŒ Invalid or missing group_id in URL.");
        return;
    }

    groupId = parseInt(groupId); // Convert to integer
    console.log("Final group_id used:", groupId); // Debugging

    // Fetch server list for the specified group_id
    fetch(`/api/servers/${groupId}`)
        .then(response => {
            console.log("API Response Status:", response.status); // Debugging
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log("API Response Data:", data); // Debugging
            if (data.status === "success") {
                const serverWeightsDiv = document.getElementById("serverWeights");
                serverWeightsDiv.innerHTML = "";
                data.servers.forEach(server => {
                    const div = document.createElement("div");
                    div.className = "dropdown-group";
                    div.innerHTML = `
                        <label>${server.ip} Weight:</label>
                        <select class="customselect" id="weight_${server.id}">
                            <option value="0">0</option>
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="30">30</option>
                            <option value="40">40</option>
                            <option value="50">50</option>
                            <option value="60">60</option>
                            <option value="70">70</option>
                            <option value="80">80</option>
                            <option value="90">90</option>
                            <option value="100">100</option>
                        </select>
                    `;
                    serverWeightsDiv.appendChild(div);
                });
            } else {
                console.error("Failed to fetch server data:", data.message);
            }
        })
        .catch(error => console.error("Error fetching server data:", error));
});

    </script>
{% endblock %}
